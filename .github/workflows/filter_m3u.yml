# Bu dosyayı şu yola kaydetmelisiniz: .github/workflows/update_m3u.yml
name: Türkiye ve XXX M3U Listelerini Güncelle

on:
  # Her saat başında otomatik olarak çalıştır
  schedule:
    - cron: '0 * * * *'
  
  # Manuel olarak da çalıştırabilmek için
  workflow_dispatch:

jobs:
  build-and-commit:
    runs-on: ubuntu-latest
    
    # Bu işin depoya kod yazma (commit atma) izni olması gerekir
    permissions:
      contents: write
      
    steps:
      # 1. Deponuzdaki kodları (rus.m3u, filter_m3u.py) klonlar
      - name: Depoyu Klonla (Checkout)
        uses: actions/checkout@v4

      # 2. Python 3.10 sürümünü kurar
      - name: Python 3.10 Kur
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. Python betiğini çalıştırır (Bu betik turkey.m3u ve xxx.m3u dosyalarını oluşturur)
      - name: M3U Filtreleme Script'ini Çalıştır
        run: python filter_m3u.py

      # 4. Oluşturulan dosyalarda değişiklik varsa depoya commit'ler
      - name: Değişiklikleri Kontrol Et ve Commit'le
        run: |
          # Git için bot kimliğini ayarla
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'github-actions-bot@users.noreply.github.com'
          
          # Python script'inde tanımlanan çıktı dosyaları
          FILE1="turkey.m3u"
          FILE2="xxx.m3u"
          
          # Dosyaları Git'e ekle (eğer değişmişlerse veya yenilerse)
          git add $FILE1
          git add $FILE2
          
          # 'git status --porcelain' komutu, "stage" edilmiş (eklenmiş) değişiklikler varsa
          # boş olmayan bir çıktı verir. Eğer boşsa, değişiklik yok demektir.
          if [[ -z $(git status --porcelain) ]]; then
            echo "Değişiklik yok, commit atılmayacak."
          else
            echo "Değişiklikler bulundu, commit atılıyor..."
            # Commit mesajı oluştur
            git commit -m "Oto-güncelleme: M3U listeleri (Build ${{ github.run_number }})"
            # Değişiklikleri depoya yolla (push)
            git push
          fi