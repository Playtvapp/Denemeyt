name: M3U Playlist Güncelleme (Kolay Yöntem)

on:
  # Manuel olarak çalıştırma (Actions sekmesinden)
  workflow_dispatch:
  
  # Her 6 saatte bir otomatik çalıştırma
  schedule:
    - cron: '0 */6 * * *'

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest

    # Depoya yazma izni (commit için gerekli)
    permissions:
      contents: write  

    steps:
      # 1. Depoyu Klonla
      - name: Depoyu Klonla (Checkout)
        uses: actions/checkout@v4

      # 2. Python 3.10 Kur
      - name: Python 3.10 Kur
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip' 

      # 3. Bağımlılıkları Kur (requests)
      - name: Bağımlılıkları Kur
        run: pip install requests

      # 4. Python betiğini çalıştır
      # (Artık 'env:' bloğuna gerek yok, çünkü şifre kodun içinde)
      - name: Playlist'i Çek (fetch_playlist.py)
        run: python fetch_playlist.py

      # 5. Değişiklikleri Depoya Gönder (Commit)
      - name: Değişiklikleri Depoya Gönder (Commit)
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          git add indirilen_playlist.m3u
          
          # Sadece dosya değiştiyse commit at
          git diff-index --quiet HEAD || git commit -m "Otomatik Güncelleme: M3U playlist yenilendi"
          
          git push