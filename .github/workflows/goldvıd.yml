name: M3U Playlist Güncelleme

on:
  # 1. Manuel olarak çalıştırma (GitHub Arayüzü > Actions sekmesinden)
  workflow_dispatch:
  
  # 2. Zamanlanmış görev (schedule)
  # Bu örnek her 6 saatte bir çalışır (UTC zaman dilimine göre)
  # Kendi istediğiniz bir zamana göre ayarlayabilirsiniz.
  # "cron: '0 */6 * * *'"  (Her 6 saatte bir)
  # "cron: '0 4 * * *'"     (Her gün UTC 04:00'te)
  schedule:
    - cron: '0 */6 * * *'

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest

    # !!! ÖNEMLİ: Bu bölüm, iş akışına depoya yazma izni verir !!!
    permissions:
      contents: write  # Depo içeriğine yazma izni (commit yapmak için)

    steps:
      # 1. Depodaki kodu klonla
      - name: Depoyu Klonla (Checkout)
        uses: actions/checkout@v4

      # 2. Python 3.10'u kur
      - name: Python 3.10 Kur
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip' # pip bağımlılıklarını önbelleğe al

      # 3. Python bağımlılıklarını kur (requests)
      - name: Bağımlılıkları Kur
        run: pip install requests

      # 4. Python betiğini çalıştır
      - name: Playlist'i Çek (fetch_playlist.py)
        # BU ADIM ÇOK ÖNEMLİ:
        # GitHub Secrets'ta tanımladığınız VOD_USERNAME ve VOD_PASSWORD
        # sırlarını 'env:' ile python betiğine ortam değişkeni olarak aktarır.
        env:
          VOD_USERNAME: ${{ secrets.VOD_USERNAME }}
          VOD_PASSWORD: ${{ secrets.VOD_PASSWORD }}
        run: python create_playlist.py

      # 5. Oluşturulan dosyayı (indirilen_playlist.m3u) depoya commit et
      - name: Değişiklikleri Depoya Gönder (Commit)
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # 'indirilen_playlist.m3u' dosyasını ekle
          git add indirilen_playlist.m3u
          
          # Sadece 'git status' bir değişiklik gösteriyorsa commit yap
          # (Eğer playlist değişmediyse boş commit atmaz)
          git diff-index --quiet HEAD || git commit -m "Otomatik Güncelleme: M3U playlist yenilendi"
          
          # Değişiklikleri depoya 'push' et
          git push